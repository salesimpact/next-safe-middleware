'use strict';Object.defineProperty(exports,'__esModule',{value:true});var builder=require('@strict-csp/builder');var Document=require('next/document');var React=require('react');var crypto=require('crypto');var cheerio=require('cheerio');function _interopDefaultLegacy(e){return e&& typeof e==='object'&&'default'in e?e:{'default':e}}var Document__default=_interopDefaultLegacy(Document);var React__default=_interopDefaultLegacy(React);var crypto__default=_interopDefaultLegacy(crypto);var cheerio__default=_interopDefaultLegacy(cheerio);const CSP_LOCATION_BUILD='.next/static/~csp';const CSP_MANIFEST_FILENAME='csp-manifest.json';const CSP_HEADER='content-security-policy';const CSP_HEADER_REPORT_ONLY='content-security-policy-report-only';const CSP_NONCE_HEADER='csp-nonce';function _isPlaceholder(a){return a!=null&& typeof a==='object'&&a['@@functional/placeholder']===true}function _curry1(fn){return function f1(a){if(arguments.length===0||_isPlaceholder(a)){return f1}else{return fn.apply(this,arguments)}}}function _curry2(fn){return function f2(a,b){switch(arguments.length){case 0:return f2;case 1:return _isPlaceholder(a)?f2:_curry1(function(_b){return fn(a,_b)});default:return _isPlaceholder(a)&&_isPlaceholder(b)?f2:_isPlaceholder(a)?_curry1(function(_a){return fn(_a,b)}):_isPlaceholder(b)?_curry1(function(_b){return fn(a,_b)}):fn(a,b)}}}function _arity(n,fn){switch(n){case 0:return function(){return fn.apply(this,arguments)};case 1:return function(a0){return fn.apply(this,arguments)};case 2:return function(a0,a1){return fn.apply(this,arguments)};case 3:return function(a0,a1,a2){return fn.apply(this,arguments)};case 4:return function(a0,a1,a2,a3){return fn.apply(this,arguments)};case 5:return function(a0,a1,a2,a3,a4){return fn.apply(this,arguments)};case 6:return function(a0,a1,a2,a3,a4,a5){return fn.apply(this,arguments)};case 7:return function(a0,a1,a2,a3,a4,a5,a6){return fn.apply(this,arguments)};case 8:return function(a0,a1,a2,a3,a4,a5,a6,a7){return fn.apply(this,arguments)};case 9:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8){return fn.apply(this,arguments)};case 10:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9){return fn.apply(this,arguments)};default:throw new Error('First argument to _arity must be a non-negative integer no greater than ten')}}function _curryN(length,received,fn){return function(){var combined=[];var argsIdx=0;var left=length;var combinedIdx=0;while(combinedIdx<received.length||argsIdx<arguments.length){var result;if(combinedIdx<received.length&&(!_isPlaceholder(received[combinedIdx])||argsIdx>=arguments.length)){result=received[combinedIdx]}else{result=arguments[argsIdx];argsIdx+=1}combined[combinedIdx]=result;if(!_isPlaceholder(result)){left-=1}combinedIdx+=1}return left<=0?fn.apply(this,combined):_arity(left,_curryN(length,combined,fn))}}var curryN=_curry2(function curryN(length,fn){if(length===1){return _curry1(fn)}return _arity(length,_curryN(length,[],fn))});function _curry3(fn){return function f3(a,b,c){switch(arguments.length){case 0:return f3;case 1:return _isPlaceholder(a)?f3:_curry2(function(_b,_c){return fn(a,_b,_c)});case 2:return _isPlaceholder(a)&&_isPlaceholder(b)?f3:_isPlaceholder(a)?_curry2(function(_a,_c){return fn(_a,b,_c)}):_isPlaceholder(b)?_curry2(function(_b,_c){return fn(a,_b,_c)}):_curry1(function(_c){return fn(a,b,_c)});default:return _isPlaceholder(a)&&_isPlaceholder(b)&&_isPlaceholder(c)?f3:_isPlaceholder(a)&&_isPlaceholder(b)?_curry2(function(_a,_b){return fn(_a,_b,c)}):_isPlaceholder(a)&&_isPlaceholder(c)?_curry2(function(_a,_c){return fn(_a,b,_c)}):_isPlaceholder(b)&&_isPlaceholder(c)?_curry2(function(_b,_c){return fn(a,_b,_c)}):_isPlaceholder(a)?_curry1(function(_a){return fn(_a,b,c)}):_isPlaceholder(b)?_curry1(function(_b){return fn(a,_b,c)}):_isPlaceholder(c)?_curry1(function(_c){return fn(a,b,_c)}):fn(a,b,c)}}}var _isArray=Array.isArray||function _isArray(val){return val!=null&&val.length>=0&&Object.prototype.toString.call(val)==='[object Array]'};function _isTransformer(obj){return obj!=null&& typeof obj['@@transducer/step']==='function'}function _dispatchable(methodNames,transducerCreator,fn){return function(){if(arguments.length===0){return fn()}var obj=arguments[arguments.length-1];if(!_isArray(obj)){var idx=0;while(idx<methodNames.length){if(typeof obj[methodNames[idx]]==='function'){return obj[methodNames[idx]].apply(obj,Array.prototype.slice.call(arguments,0,-1))}idx+=1}if(_isTransformer(obj)){var transducer=transducerCreator.apply(null,Array.prototype.slice.call(arguments,0,-1));return transducer(obj)}}return fn.apply(this,arguments)}}var _xfBase={init:function(){return this.xf['@@transducer/init']()},result:function(result){return this.xf['@@transducer/result'](result)}};var max=_curry2(function max(a,b){return b>a?b:a});function _map(fn,functor){var idx=0;var len=functor.length;var result=Array(len);while(idx<len){result[idx]=fn(functor[idx]);idx+=1}return result}function _isString(x){return Object.prototype.toString.call(x)==='[object String]'}var _isArrayLike=_curry1(function isArrayLike(x){if(_isArray(x)){return true}if(!x){return false}if(typeof x!=='object'){return false}if(_isString(x)){return false}if(x.length===0){return true}if(x.length>0){return x.hasOwnProperty(0)&&x.hasOwnProperty(x.length-1)}return false});var XWrap=function(){function XWrap1(fn){this.f=fn}XWrap1.prototype['@@transducer/init']=function(){throw new Error('init not implemented on XWrap')};XWrap1.prototype['@@transducer/result']=function(acc){return acc};XWrap1.prototype['@@transducer/step']=function(acc,x){return this.f(acc,x)};return XWrap1}();function _xwrap(fn){return new XWrap(fn)}var bind=_curry2(function bind(fn,thisObj){return _arity(fn.length,function(){return fn.apply(thisObj,arguments)})});function _arrayReduce(xf,acc,list){var idx=0;var len=list.length;while(idx<len){acc=xf['@@transducer/step'](acc,list[idx]);if(acc&&acc['@@transducer/reduced']){acc=acc['@@transducer/value'];break}idx+=1}return xf['@@transducer/result'](acc)}function _iterableReduce(xf,acc,iter){var step=iter.next();while(!step.done){acc=xf['@@transducer/step'](acc,step.value);if(acc&&acc['@@transducer/reduced']){acc=acc['@@transducer/value'];break}step=iter.next()}return xf['@@transducer/result'](acc)}function _methodReduce(xf,acc,obj,methodName){return xf['@@transducer/result'](obj[methodName](bind(xf['@@transducer/step'],xf),acc))}var symIterator=typeof Symbol!=='undefined'?Symbol.iterator:'@@iterator';function _reduce(fn,acc,list){if(typeof fn==='function'){fn=_xwrap(fn)}if(_isArrayLike(list)){return _arrayReduce(fn,acc,list)}if(typeof list['fantasy-land/reduce']==='function'){return _methodReduce(fn,acc,list,'fantasy-land/reduce')}if(list[symIterator]!=null){return _iterableReduce(fn,acc,list[symIterator]())}if(typeof list.next==='function'){return _iterableReduce(fn,acc,list)}if(typeof list.reduce==='function'){return _methodReduce(fn,acc,list,'reduce')}throw new TypeError('reduce: list must be array or iterable')}var XMap=function(){function XMap1(f,xf){this.xf=xf;this.f=f}XMap1.prototype['@@transducer/init']=_xfBase.init;XMap1.prototype['@@transducer/result']=_xfBase.result;XMap1.prototype['@@transducer/step']=function(result,input){return this.xf['@@transducer/step'](result,this.f(input))};return XMap1}();var _xmap=_curry2(function _xmap(f,xf){return new XMap(f,xf)});function _has(prop1,obj){return Object.prototype.hasOwnProperty.call(obj,prop1)}var toString=Object.prototype.toString;var _isArguments=function(){return toString.call(arguments)==='[object Arguments]'?function _isArguments(x){return toString.call(x)==='[object Arguments]'}:function _isArguments(x){return _has('callee',x)}}();var hasEnumBug=!({toString:null}).propertyIsEnumerable('toString');var nonEnumerableProps=['constructor','valueOf','isPrototypeOf','toString','propertyIsEnumerable','hasOwnProperty','toLocaleString'];var hasArgsEnumBug=function(){return arguments.propertyIsEnumerable('length')}();var contains=function contains(list,item){var idx=0;while(idx<list.length){if(list[idx]===item){return true}idx+=1}return false};var keys=typeof Object.keys==='function'&&!hasArgsEnumBug?_curry1(function keys(obj){return Object(obj)!==obj?[]:Object.keys(obj)}):_curry1(function keys(obj){if(Object(obj)!==obj){return[]}var prop2,nIdx;var ks=[];var checkArgsLength=hasArgsEnumBug&&_isArguments(obj);for(prop2 in obj){if(_has(prop2,obj)&&(!checkArgsLength||prop2!=='length')){ks[ks.length]=prop2}}if(hasEnumBug){nIdx=nonEnumerableProps.length-1;while(nIdx>=0){prop2=nonEnumerableProps[nIdx];if(_has(prop2,obj)&&!contains(ks,prop2)){ks[ks.length]=prop2}nIdx-=1}}return ks});var map=_curry2(_dispatchable(['fantasy-land/map','map'],_xmap,function map(fn,functor){switch(Object.prototype.toString.call(functor)){case'[object Function]':return curryN(functor.length,function(){return fn.call(this,functor.apply(this,arguments))});case'[object Object]':return _reduce(function(acc,key){acc[key]=fn(functor[key]);return acc},{},keys(functor));default:return _map(fn,functor)}}));var map$1=map;var _isInteger=Number.isInteger||function _isInteger(n){return n<<0===n};var nth=_curry2(function nth(offset,list){var idx=offset<0?list.length+offset:offset;return _isString(list)?list.charAt(idx):list[idx]});var prop=_curry2(function prop(p,obj){if(obj==null){return}return _isInteger(p)?nth(p,obj):obj[p]});var pluck=_curry2(function pluck(p,list){return map$1(prop(p),list)});var reduce=_curry3(_reduce);function _makeFlat(recursive){return function flatt(list){var value,jlen,j;var result=[];var idx=0;var ilen=list.length;while(idx<ilen){if(_isArrayLike(list[idx])){value=recursive?flatt(list[idx]):list[idx];j=0;jlen=value.length;while(j<jlen){result[result.length]=value[j];j+=1}}else{result[result.length]=list[idx]}idx+=1}return result}}var type=_curry1(function type(val){return val===null?'Null':val===undefined?'Undefined':Object.prototype.toString.call(val).slice(8,-1)});function _identity(x){return x}var identity=_curry1(_identity);function _arrayFromIterator(iter){var list=[];var next;while(!(next=iter.next()).done){list.push(next.value)}return list}function _includesWith(pred,x,list){var idx=0;var len=list.length;while(idx<len){if(pred(x,list[idx])){return true}idx+=1}return false}function _functionName(f){var match=String(f).match(/^function (\w*)/);return match==null?'':match[1]}function _objectIs(a,b){if(a===b){return a!==0||1/a===1/b}else{return a!==a&&b!==b}}var _objectIs$1=typeof Object.is==='function'?Object.is:_objectIs;function _uniqContentEquals(aIterator,bIterator,stackA,stackB){var a=_arrayFromIterator(aIterator);var b1=_arrayFromIterator(bIterator);function eq(_a,_b){return _equals(_a,_b,stackA.slice(),stackB.slice())}return!_includesWith(function(b,aItem){return!_includesWith(eq,aItem,b)},b1,a)}function _equals(a,b,stackA,stackB){if(_objectIs$1(a,b)){return true}var typeA=type(a);if(typeA!==type(b)){return false}if(typeof a['fantasy-land/equals']==='function'|| typeof b['fantasy-land/equals']==='function'){return typeof a['fantasy-land/equals']==='function'&&a['fantasy-land/equals'](b)&& typeof b['fantasy-land/equals']==='function'&&b['fantasy-land/equals'](a)}if(typeof a.equals==='function'|| typeof b.equals==='function'){return typeof a.equals==='function'&&a.equals(b)&& typeof b.equals==='function'&&b.equals(a)}switch(typeA){case'Arguments':case'Array':case'Object':if(typeof a.constructor==='function'&&_functionName(a.constructor)==='Promise'){return a===b}break;case'Boolean':case'Number':case'String':if(!(typeof a===typeof b&&_objectIs$1(a.valueOf(),b.valueOf()))){return false}break;case'Date':if(!_objectIs$1(a.valueOf(),b.valueOf())){return false}break;case'Error':return a.name===b.name&&a.message===b.message;case'RegExp':if(!(a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline&&a.sticky===b.sticky&&a.unicode===b.unicode)){return false}break}var idx=stackA.length-1;while(idx>=0){if(stackA[idx]===a){return stackB[idx]===b}idx-=1}switch(typeA){case'Map':if(a.size!==b.size){return false}return _uniqContentEquals(a.entries(),b.entries(),stackA.concat([a]),stackB.concat([b]));case'Set':if(a.size!==b.size){return false}return _uniqContentEquals(a.values(),b.values(),stackA.concat([a]),stackB.concat([b]));case'Arguments':case'Array':case'Object':case'Boolean':case'Number':case'String':case'Date':case'Error':case'RegExp':case'Int8Array':case'Uint8Array':case'Uint8ClampedArray':case'Int16Array':case'Uint16Array':case'Int32Array':case'Uint32Array':case'Float32Array':case'Float64Array':case'ArrayBuffer':break;default:return false}var keysA=keys(a);if(keysA.length!==keys(b).length){return false}var extendedStackA=stackA.concat([a]);var extendedStackB=stackB.concat([b]);idx=keysA.length-1;while(idx>=0){var key=keysA[idx];if(!(_has(key,b)&&_equals(b[key],a[key],extendedStackA,extendedStackB))){return false}idx-=1}return true}var equals=_curry2(function equals(a,b){return _equals(a,b,[],[])});function _indexOf(list,a,idx){var inf,item;if(typeof list.indexOf==='function'){switch(typeof a){case'number':if(a===0){inf=1/a;while(idx<list.length){item=list[idx];if(item===0&&1/item===inf){return idx}idx+=1}return-1}else if(a!==a){while(idx<list.length){item=list[idx];if(typeof item==='number'&&item!==item){return idx}idx+=1}return-1}return list.indexOf(a,idx);case'string':case'boolean':case'function':case'undefined':return list.indexOf(a,idx);case'object':if(a===null){return list.indexOf(a,idx)}}}while(idx<list.length){if(equals(list[idx],a)){return idx}idx+=1}return-1}function _includes(a,list){return _indexOf(list,a,0)>=0}function _complement(f){return function(){return!f.apply(this,arguments)}}function _filter(fn,list){var idx=0;var len=list.length;var result=[];while(idx<len){if(fn(list[idx])){result[result.length]=list[idx]}idx+=1}return result}function _isObject(x){return Object.prototype.toString.call(x)==='[object Object]'}var XFilter=function(){function XFilter1(f,xf){this.xf=xf;this.f=f}XFilter1.prototype['@@transducer/init']=_xfBase.init;XFilter1.prototype['@@transducer/result']=_xfBase.result;XFilter1.prototype['@@transducer/step']=function(result,input){return this.f(input)?this.xf['@@transducer/step'](result,input):result};return XFilter1}();var _xfilter=_curry2(function _xfilter(f,xf){return new XFilter(f,xf)});var filter=_curry2(_dispatchable(['fantasy-land/filter','filter'],_xfilter,function(pred,filterable){return _isObject(filterable)?_reduce(function(acc,key){if(pred(filterable[key])){acc[key]=filterable[key]}return acc},{},keys(filterable)):_filter(pred,filterable)}));var reject=_curry2(function reject(pred,filterable){return filter(_complement(pred),filterable)});var converge=_curry2(function converge(after,fns){return curryN(reduce(max,0,pluck('length',fns)),function(){var args=arguments;var context=this;return after.apply(context,_map(function(fn){return fn.apply(context,args)},fns))})});var _Set=function(){function _Set1(){this._nativeSet=typeof Set==='function'?new Set():null;this._items={}}_Set1.prototype.add=function(item){return!hasOrAdd(item,true,this)};_Set1.prototype.has=function(item){return hasOrAdd(item,false,this)};return _Set1}();function hasOrAdd(item,shouldAdd,set){var type1=typeof item;var prevSize,newSize;switch(type1){case'string':case'number':if(item===0&&1/item=== -Infinity){if(set._items['-0']){return true}else{if(shouldAdd){set._items['-0']=true}return false}}if(set._nativeSet!==null){if(shouldAdd){prevSize=set._nativeSet.size;set._nativeSet.add(item);newSize=set._nativeSet.size;return newSize===prevSize}else{return set._nativeSet.has(item)}}else{if(!(type1 in set._items)){if(shouldAdd){set._items[type1]={};set._items[type1][item]=true}return false}else if(item in set._items[type1]){return true}else{if(shouldAdd){set._items[type1][item]=true}return false}}case'boolean':if(type1 in set._items){var bIdx=item?1:0;if(set._items[type1][bIdx]){return true}else{if(shouldAdd){set._items[type1][bIdx]=true}return false}}else{if(shouldAdd){set._items[type1]=item?[false,true]:[true,false]}return false}case'function':if(set._nativeSet!==null){if(shouldAdd){prevSize=set._nativeSet.size;set._nativeSet.add(item);newSize=set._nativeSet.size;return newSize===prevSize}else{return set._nativeSet.has(item)}}else{if(!(type1 in set._items)){if(shouldAdd){set._items[type1]=[item]}return false}if(!_includes(item,set._items[type1])){if(shouldAdd){set._items[type1].push(item)}return false}return true}case'undefined':if(set._items[type1]){return true}else{if(shouldAdd){set._items[type1]=true}return false}case'object':if(item===null){if(!set._items['null']){if(shouldAdd){set._items['null']=true}return false}return true}default:type1=Object.prototype.toString.call(item);if(!(type1 in set._items)){if(shouldAdd){set._items[type1]=[item]}return false}if(!_includes(item,set._items[type1])){if(shouldAdd){set._items[type1].push(item)}return false}return true}}var difference=_curry2(function difference(first,second){var out=[];var idx=0;var firstLen=first.length;var secondLen=second.length;var toFilterOut=new _Set();for(var i=0;i<secondLen;i+=1){toFilterOut.add(second[i])}while(idx<firstLen){if(toFilterOut.add(first[idx])){out[out.length]=first[idx]}idx+=1}return out});var difference$1=difference;var flatten=_curry1(_makeFlat(true));var flatten$1=flatten;var XUniqBy=function(){function XUniqBy1(f,xf){this.xf=xf;this.f=f;this.set=new _Set()}XUniqBy1.prototype['@@transducer/init']=_xfBase.init;XUniqBy1.prototype['@@transducer/result']=_xfBase.result;XUniqBy1.prototype['@@transducer/step']=function(result,input){return this.set.add(this.f(input))?this.xf['@@transducer/step'](result,input):result};return XUniqBy1}();var _xuniqBy=_curry2(function _xuniqBy(f,xf){return new XUniqBy(f,xf)});var uniqBy=_curry2(_dispatchable([],_xuniqBy,function(fn,list){var set=new _Set();var result=[];var idx=0;var appliedItem,item;while(idx<list.length){item=list[idx];appliedItem=fn(item);if(set.add(appliedItem)){result.push(item)}idx+=1}return result}));var uniq=uniqBy(identity);var uniq$1=uniq;var juxt=_curry1(function juxt(fns){return converge(function(){return Array.prototype.slice.call(arguments,0)},fns)});function _isNumber(x){return Object.prototype.toString.call(x)==='[object Number]'}var maxBy=_curry3(function maxBy(f,a,b){return f(b)>f(a)?b:a});var maxBy$1=maxBy;var mergeWithKey=_curry3(function mergeWithKey(fn,l,r){var result={};var k;for(k in l){if(_has(k,l)){result[k]=_has(k,r)?fn(k,l[k],r[k]):l[k]}}for(k in r){if(_has(k,r)&&!_has(k,result)){result[k]=r[k]}}return result});var mergeDeepWithKey=_curry3(function mergeDeepWithKey1(fn,lObj,rObj){return mergeWithKey(function(k,lVal,rVal){if(_isObject(lVal)&&_isObject(rVal)){return mergeDeepWithKey1(fn,lVal,rVal)}else{return fn(k,lVal,rVal)}},lObj,rObj)});var mergeDeepWithKey$1=mergeDeepWithKey;var partition=juxt([filter,reject]);var partition$1=partition;var range=_curry2(function range(from,to){if(!(_isNumber(from)&&_isNumber(to))){throw new TypeError('Both arguments to range must be numbers')}var result=[];var n=from;while(n<to){result.push(n);n+=1}return result});var range$1=range;var sortBy=_curry2(function sortBy(fn,list){return Array.prototype.slice.call(list,0).sort(function(a,b){var aa=fn(a);var bb=fn(b);return aa<bb?-1:aa>bb?1:0})});var sortBy$1=sortBy;var splitWhenever=_curryN(2,[],function splitWhenever(pred,list){var acc=[];var curr=[];for(var i=0;i<list.length;i=i+1){if(!pred(list[i])){curr.push(list[i])}if((i<list.length-1&&pred(list[i+1])||i===list.length-1)&&curr.length>0){acc.push(curr);curr=[]}}return acc});var splitWhenever$1=splitWhenever;var zip=_curry2(function zip(a,b){var rv=[];var idx=0;var len=Math.min(a.length,b.length);while(idx<len){rv[idx]=[a[idx],b[idx]];idx+=1}return rv});var zip$1=zip;const getCtxReqHeader=(ctx,header)=>{if(ctx.req){const headerValue=ctx.req.headers[header];if(typeof headerValue==="string"|| typeof headerValue==="number"){return`${headerValue}`}if(Array.isArray(headerValue)&&headerValue.every(v=>typeof v==="string")){return headerValue.join(",")}}return""};const getCtxResHeader=(ctx,header)=>{if(ctx.res){const headerValue=ctx.res.getHeader(header);if(typeof headerValue==="string"|| typeof headerValue==="number"){return`${headerValue}`}if(Array.isArray(headerValue)&&headerValue.every(v=>typeof v==="string")){return headerValue.join(",")}}return""};const getCtxHeader=(ctx,header)=>{return getCtxResHeader(ctx,header)||getCtxReqHeader(ctx,header)};const setCtxReqHeader=(ctx,header,value)=>{if(ctx.req){ctx.req.headers[header]=value}};const setCtxResHeader=(ctx,header,value)=>{if(ctx.res&&!ctx.res.headersSent){ctx.res.setHeader(header,value)}};const setCtxHeader=(ctx,header,value)=>{setCtxReqHeader(ctx,header,value);setCtxResHeader(ctx,header,value)};const deleteCtxReqHeader=(ctx,header)=>{try{if(ctx.req){delete ctx.req.headers[header];return true}}finally{return false}};const deleteCtxResHeader=(ctx,header)=>{try{if(ctx.res&&!ctx.res.headersSent){ctx.res.removeHeader(header);return true}}finally{return false}};const deleteCtxHeader=(ctx,header)=>{deleteCtxReqHeader(ctx,header);deleteCtxResHeader(ctx,header)};const excludeLongSecurityHeaders=header=>{const headerLower=header[0].toLowerCase();return headerLower!==CSP_HEADER&&headerLower!==CSP_HEADER_REPORT_ONLY&&headerLower!=="feature-policy"&&headerLower!=="permissions-policy"};const logCtxHeaders=(ctx,excludeLongHeaders=true)=>{let reqHeaders;if(ctx?.req?.rawHeaders){const headerNames=ctx.req.rawHeaders.filter((v,idx)=>idx%2===0);const headerValues=ctx.req.rawHeaders.filter((v,idx)=>idx%2===1);let headers=zip$1(headerNames,headerValues);if(excludeLongHeaders){headers=headers.filter(excludeLongSecurityHeaders)}reqHeaders=Object.fromEntries(headers)}let resHeaders;if(ctx.res){let headers=ctx.res.getHeaderNames().map(header=>[header,ctx.res.getHeader(header).toString()]);if(excludeLongSecurityHeaders){headers=headers.filter(excludeLongSecurityHeaders)}resHeaders=Object.fromEntries(headers)}if(reqHeaders||resHeaders){console.info("[_document]:",JSON.stringify({ctx:{headers:{req:reqHeaders?reqHeaders:undefined,res:resHeaders?resHeaders:undefined}}}))}};let nonceBits=128;const setNonceBits=bits=>nonceBits=bits;const generateNonce=(bits=128)=>{const crypto1=require("crypto");return crypto1.randomBytes(Math.floor(bits/8)).toString("base64")};const nonce=()=>generateNonce(nonceBits);const getCtxNonce=ctx=>{return getCtxHeader(ctx,CSP_NONCE_HEADER)};const getCreateCtxNonceIdempotent=ctx=>{if(process.env.NODE_ENV!=="production"){return""}let _nonce=getCtxNonce(ctx);if(!_nonce){_nonce=nonce();setCtxHeader(ctx,CSP_NONCE_HEADER,_nonce)}return _nonce};const getCspFromHeader=(ctx,getter)=>{if(ctx.req){const cspContent=getter(ctx,CSP_HEADER);const cspContentReportOnly=getter(ctx,CSP_HEADER_REPORT_ONLY);if(cspContent){return new builder.CspBuilder({directives:cspContent,reportOnly:false})}if(cspContentReportOnly){return new builder.CspBuilder({directives:cspContentReportOnly,reportOnly:false})}}return null};const getCspFromReqHeader=ctx=>getCspFromHeader(ctx,getCtxReqHeader);const getCspFromResHeader=ctx=>getCspFromHeader(ctx,getCtxResHeader);const getCtxCsp=ctx=>{const fromRes=getCspFromResHeader(ctx);return fromRes?fromRes:getCspFromReqHeader(ctx)??new builder.CspBuilder()};const setCtxCsp=(ctx,builder1)=>{deleteCtxHeader(ctx,CSP_HEADER);deleteCtxHeader(ctx,CSP_HEADER_REPORT_ONLY);const[header,value]=builder1.toHeaderKeyValue();if(value){setCtxHeader(ctx,header,value)}};function gsspWithNonce(getServerSideProps){return async ctx=>{const gsspResult=await getServerSideProps(ctx);if("props"in gsspResult){const nonce1=getCreateCtxNonceIdempotent(ctx);const props=await gsspResult.props;return{props:{...props,nonce:nonce1}}}}}function gipWithNonce(getInitialProps){return async ctx=>{const props=await getInitialProps(ctx);const nonce2=getCreateCtxNonceIdempotent(ctx);return{...props,nonce:nonce2}}}const gsspWithNonceAppliedToCsp=gsspWithNonce;const gipWithNonceAppliedToCsp=gipWithNonce;let hashAlgorithm="sha256";const setHashAlgorithm=algorithm=>hashAlgorithm=algorithm;const hashWithAlgorithm=(text,algorithm="sha256")=>{const hash1=crypto__default["default"].createHash(algorithm);hash1.update(text);return`${algorithm}-${hash1.digest("base64")}`};const hash=text=>hashWithAlgorithm(text,hashAlgorithm);function extends_(){extends_=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return extends_.apply(this,arguments)}function _extends(){return extends_.apply(this,arguments)}const isJsxElement=el=>!!el&& typeof el==="object"&&"props"in el;const isElementWithChildren=el=>isJsxElement(el)&&"children"in el.props;const isScriptElement=el=>isJsxElement(el)&&el.type==="script";const isScriptElementWithIntegrity=el=>isJsxElement(el)&&!!el.props.integrity;const isScriptElementWithoutIntegrity=el=>isJsxElement(el)&&!el.props.integrity;const isLinkElement=el=>isJsxElement(el)&&el.type==="link"&&!!el.props.href;const isScriptPreloadLink=el=>isLinkElement(el)&&el.props.as==="script";const isStyleElement=el=>isJsxElement(el)&&el.type==="style";const isInlineStyleElement=el=>isStyleElement(el)&&!!el.props.dangerouslySetInnerHTML?.__html;const isStyleSheetElement=el=>isLinkElement(el)&&el.props.rel==="stylesheet";const withStringChildrenAsInlineCode=el=>{if(typeof el.props.children!=="string"){return el}const{children,...props}=el.props.children;return React__default["default"].createElement("script",_extends({key:el.key},props,{dangerouslySetInnerHTML:{__html:el.props.children}}))};const sameLengthPaddedArrays=(a,b)=>{const maxLength=maxBy$1(arr=>arr.length,a,b).length;const aPadLength=maxLength-a.length;const bPadLength=maxLength-b.length;const aPadding=range$1(0,aPadLength).map(()=>[]);const bPadding=range$1(0,bPadLength).map(()=>[]);return[[...a,...aPadding],[...b,...bPadding],]};const sameLengthPaddedFlatZip=(a,b)=>{const[aPadded,bPadded]=sameLengthPaddedArrays(a,b);return flatten$1(zip$1(aPadded,bPadded))};const deepMapExtractScripts=children1=>{const recurse=children=>{if(isElementWithChildren(children)){return recurse(children.props.children)}else if(Array.isArray(children)){return children.map(recurse)}else if(isScriptElement(children)){return[children]}return[]};return flatten$1(recurse(children1))};const deepMapStripIntegrity=children2=>{const recurse=children=>{if(isElementWithChildren(children)){return recurse(children.props.children)}else if(Array.isArray(children)){return children.map(recurse)}else if(isJsxElement(children)&&!!children.props.integrity){return[React__default["default"].cloneElement(children,{integrity:null})]}return[children]};return flatten$1(recurse(children2))};const deepExtractStyleElemHashes=(children,exclude=[])=>{if(exclude.includes("styles")){return[]}const recurse=child=>{if(isInlineStyleElement(child)){return[hash(child.props.dangerouslySetInnerHTML.__html)]}if(isElementWithChildren(child)){return recurse(child.props.children)}if(Array.isArray(child)){return child.map(recurse)}return[]};return flatten$1(recurse(children))};const quoteIfString=value=>typeof value==="string"?`'${value}'`:value;const isKnownScriptAttr=attr=>["id","src","integrity","async","defer","noModule","crossOrigin","nonce","rel","href","as",].includes(attr);const getScriptValue=(attr,attrs)=>attrs.find(([a])=>attr===a)?.[1];const createHashableScriptLoader=(scripts,id,removeSelf)=>{const element=attrs=>{if(getScriptValue("rel",attrs)==="preload"&&!!getScriptValue("href",attrs)){return"link"}return"script"};return scripts.length>0?`(function () { ${scripts.map((attrs,i)=>`
  var s${i} = document.createElement('${element(attrs)}');
  ${attrs?.map(([attr,value])=>isKnownScriptAttr(attr)?`s${i}.${attr}=${quoteIfString(value)}`:`s${i}.setAttribute('${attr}', '${value}')`).join(";")}`).join(";")};
  var s = [${scripts.map((s,i)=>`s${i}`).join(",")}];
  var self = document.getElementById('${id}');
  var p = self.parentNode;
  ${removeSelf?`p.removeChild(self);`:``}
  s.forEach(function(si) {
    p.appendChild(si);
  });
})()
`:""};const withHashIfInlineScript=s=>{if(!isScriptElement(s)){return s}const{children,dangerouslySetInnerHTML,...props}=s.props;let inlineScriptCode="";if(typeof children==="string"){inlineScriptCode=s.props.children}else if(dangerouslySetInnerHTML){inlineScriptCode=dangerouslySetInnerHTML.__html}if(!inlineScriptCode){return s}return React__default["default"].createElement("script",_extends({key:s.key},props,{integrity:hash(inlineScriptCode),dangerouslySetInnerHTML:{__html:inlineScriptCode}}))};const iterableScriptFromProps=el=>{if(!(isScriptElement(el)||isScriptPreloadLink(el)))return null;return Object.entries(el.props).filter(([,value])=>!!value&&(typeof value==="string"|| typeof value==="boolean"|| typeof value==="number"))};const sortIterableScriptByAttr=s=>{return sortBy$1(([attr])=>attr,s)};const proxyGuid="csp-proxy-loader-7f10ba7a15bc0318e7dd56e8c7e1cff";const createTrustedLoadingProxy=(els,removeSelf,proxyKey)=>{const iterableScripts1=deepMapStripIntegrity(els).map(iterableScriptFromProps).filter(Boolean).map(sortIterableScriptByAttr);const proxy=createHashableScriptLoader(iterableScripts1,proxyGuid,removeSelf);const id=hash(proxy).replace(/^sha\d{3}-/g,"");const inlineCode=proxy.replace(proxyGuid,id);if(!inlineCode){return React__default["default"].createElement(React.Fragment,{key:proxyKey})}const loader=withHashIfInlineScript(React__default["default"].createElement("script",{key:proxyKey||id,id:id,dangerouslySetInnerHTML:{__html:inlineCode}}));return loader};let iterableScripts=[];const collectIterableScript=(...scripts)=>{iterableScripts.push(...scripts.filter(Boolean))};const collectScriptElement=(...scripts)=>{collectIterableScript(...scripts.map(iterableScriptFromProps).filter(Boolean).map(sortIterableScriptByAttr))};const pullManifestScripts=()=>{return iterableScripts.map(s=>{const src=getScriptValue("src",s);const integrity=getScriptValue("integrity",s);if(src&&integrity){return{src:src,hash:integrity}}if(integrity){return{hash:integrity}}return null}).filter(Boolean)};const styleElem=[];const collectStyleElem=(...hashes)=>{styleElem.push(...difference$1(hashes.filter(Boolean),styleElem))};const pullStyleElem=()=>styleElem;const styleAttr=[];const collectStyleAttr=(...hashes)=>{styleAttr.push(...difference$1(hashes.filter(Boolean),styleAttr))};const pullStyleAttr=()=>styleAttr;const pullManifest=()=>{const scripts=pullManifestScripts();const styleElem1=pullStyleElem();const styleAttr1=pullStyleAttr();return{scripts,styles:{elem:styleElem1,attr:styleAttr1}}};const writeManifestToFile=(filepath,manifest,fs,read)=>{const manifestFromFile=read?JSON.parse(fs.readFileSync(filepath,"utf8")):{};const merger=(k,l,r)=>{if(Array.isArray(l)&&Array.isArray(r)){return uniq$1([...l,...r])}return r};const mergedManifest=mergeDeepWithKey$1(merger,manifestFromFile,manifest);fs.writeFileSync(filepath,JSON.stringify(mergedManifest),"utf-8")};const dotNextFolder=()=>`${process.cwd()}/.next`;const staticCspFolder=()=>`${process.cwd()}/${CSP_LOCATION_BUILD}`;const getFs=()=>{try{return require("fs")}catch{return undefined}};const writeManifestToFileWithLock=manifest=>{const fs=getFs();if(!fs){return}const dir=staticCspFolder();try{if(!fs.existsSync(dir)){fs.mkdirSync(dir,{recursive:true})}}catch{return}const filepath=`${dir}/${CSP_MANIFEST_FILENAME}`;const lockfilepath=`${filepath}.lock`;const{lock,unlock}=require("lockfile");lock(lockfilepath,{wait:1e4},err1=>{if(err1){throw err1}try{writeManifestToFile(filepath,manifest,fs,fs.existsSync(filepath))}finally{unlock(lockfilepath,err=>{if(err){throw err}})}})};const dotNextcontentCache={};const readURIFromDotNextFolder=(URI,basePath)=>{const filePath=decodeURI(URI).replace(`${basePath||""}/_next`,dotNextFolder());let content=dotNextcontentCache[filePath];if(content){return content}const fs=getFs();const assert=fs&&fs.existsSync(filePath);console.assert(assert,"readURIFromDotNextFolder: file does not exist",{filePath});if(!assert){return""}content=fs.readFileSync(filePath,"utf8");dotNextcontentCache[filePath]=content;return content};const createFragmentPaddedProxy=els=>{const proxy=createTrustedLoadingProxy(els,true,els[0]?.key);collectScriptElement(proxy);return[proxy,...els.slice(1).map(el=>React__default["default"].createElement(React.Fragment,{key:el.key}))]};const registerFragmentPaddedProxyForVariants=els=>{createFragmentPaddedProxy(els.map(s=>{return React__default["default"].cloneElement(s,{defer:true,async:false})}));createFragmentPaddedProxy(els.map(s=>{return React__default["default"].cloneElement(s,{defer:false,async:true})}));createFragmentPaddedProxy(els.map(s=>{return React__default["default"].cloneElement(s,{defer:false,async:false})}))};const ensureScriptsInManifest=(els,component)=>{const assert=Array.isArray(els)&&els.every(isScriptElement);console.assert(assert,"ensureScriptsInManifest: array of elements must be script elements",{elements:els});if(!assert){return els}const scripts=els.map(withHashIfInlineScript);const firstHasIntegrity=isScriptElementWithIntegrity(scripts[0]);const haveNoIntegrityChunks=splitWhenever$1(isScriptElementWithIntegrity,scripts);const haveIntegrityChunks=splitWhenever$1(isScriptElementWithoutIntegrity,scripts);const haveIntegrity=haveIntegrityChunks.flatMap(chunk=>chunk);collectScriptElement(...haveIntegrity);if(!haveNoIntegrityChunks.length){return haveIntegrity}if(component==="Head"){haveNoIntegrityChunks.forEach(chunk=>registerFragmentPaddedProxyForVariants(chunk))}const proxyChunks=haveNoIntegrityChunks.map(createFragmentPaddedProxy);return firstHasIntegrity?sameLengthPaddedFlatZip(haveIntegrityChunks,proxyChunks):sameLengthPaddedFlatZip(proxyChunks,haveIntegrityChunks)};const deepEnsureScriptElementsInManifest=(children1,component)=>{const recurse=children=>{if(isScriptElement(children)){try{children.props=ensureScriptsInManifest([children],component)[0].props}catch{}}else if(isElementWithChildren(children)&&Array.isArray(children.props.children)&&children.props.children.every(isScriptElement)){try{children.props.children=ensureScriptsInManifest(children.props.children,component)}catch{}}else if(isElementWithChildren(children)){recurse(children.props.children)}else if(Array.isArray(children)){children.forEach(recurse)}};recurse(children1)};const deepMapScriptsToManifest=(children2,component)=>{const recurse=children=>{if(isElementWithChildren(children)){return recurse(children.props.children)}if(Array.isArray(children)&&children.every(isScriptElement)){return ensureScriptsInManifest(children,component)}else if(Array.isArray(children)){return children.map(recurse)}else if(isScriptElement(children)){return ensureScriptsInManifest([children],component)}return[]};return flatten$1(recurse(children2))};const nextScriptWithInjectedIntegrity=(el,basePath)=>{const src=el.props.src;const scriptContent=readURIFromDotNextFolder(src,basePath);const integrity=hash(scriptContent);return React__default["default"].cloneElement(el,{integrity})};const nextPreloadScriptWithInjectedIntegrity=(el,basePath)=>{const href=el.props.href;if(!href){return React__default["default"].createElement(React.Fragment,{key:el.key})}const scriptContent=readURIFromDotNextFolder(href,basePath);const integrity=hash(scriptContent);return React__default["default"].cloneElement(el,{integrity})};const ensureNextPreloadLinksInManifest=(els,basePath)=>{const[httpsLinks,nextLinks]=partition$1(el=>el?.props?.href?.startsWith("https://"),els||[]);const httpsProxy=createFragmentPaddedProxy(deepMapStripIntegrity(httpsLinks));return[...httpsProxy,...nextLinks.map(el=>nextPreloadScriptWithInjectedIntegrity(el,basePath)),]};const isNextManifestScript=el=>el?.props?.src&&el.props.src.includes("Manifest");const ensureNextScriptsInManifest=(scripts,basePath,component,hasNextManifestFiles=false)=>{const[nextManifestScripts,nextScripts]=partition$1(isNextManifestScript,deepMapExtractScripts(scripts));if(!hasNextManifestFiles){return deepMapScriptsToManifest(nextScripts.map(s=>nextScriptWithInjectedIntegrity(s,basePath)),component)}if(component==="Head"){registerFragmentPaddedProxyForVariants(nextManifestScripts)}const manifestLoader=createFragmentPaddedProxy(nextManifestScripts);return[...deepMapScriptsToManifest([...nextScripts.map(s=>nextScriptWithInjectedIntegrity(s,basePath))],component),...manifestLoader,]};const loadNextByProxy=(proxyfiedScripts,component)=>{if(component==="Head"){registerFragmentPaddedProxyForVariants(proxyfiedScripts)}return createFragmentPaddedProxy(proxyfiedScripts)};const preNextScriptsByProxy=(scripts,component)=>{const isArray=Array.isArray(scripts);const mappedScripts=deepMapScriptsToManifest(deepMapStripIntegrity(scripts),component);return isArray?mappedScripts:React__default["default"].createElement(React.Fragment,{key:scripts.key},mappedScripts)};let excludeList=[];let hashProxy=false;const getExcludeList=()=>excludeList;const setExcludeList=x=>excludeList=x;const isHashProxy=()=>hashProxy;const setIsHashProxy=x=>hashProxy=x;class Head$1 extends Document.Head{getPreloadDynamicChunks(){let preloadScripts=super.getPreloadDynamicChunks();if(getExcludeList().includes("scripts")){return preloadScripts}if(isHashProxy()){preloadScripts=createFragmentPaddedProxy(preloadScripts);return preloadScripts}preloadScripts=ensureNextPreloadLinksInManifest(preloadScripts,this.context.canonicalBase);return preloadScripts}getPreloadMainLinks(files){let preloadScripts=super.getPreloadMainLinks(files);if(getExcludeList().includes("scripts")){return preloadScripts}if(isHashProxy()){preloadScripts=createFragmentPaddedProxy(preloadScripts);return preloadScripts}preloadScripts=ensureNextPreloadLinksInManifest(preloadScripts,this.context.canonicalBase);return preloadScripts}getBeforeInteractiveInlineScripts(){let scripts=super.getBeforeInteractiveInlineScripts();if(getExcludeList().includes("scripts")){return scripts}scripts=deepMapScriptsToManifest(scripts,"Head");return scripts}getPolyfillScripts(){let scripts=super.getPolyfillScripts();if(getExcludeList().includes("scripts")){return scripts}if(isHashProxy()){const polyfillProxy=createFragmentPaddedProxy(scripts);registerFragmentPaddedProxyForVariants(scripts);return polyfillProxy}return ensureNextScriptsInManifest(scripts,this.context.canonicalBase,"Head")}getPreNextScripts(){let scripts=super.getPreNextScripts();if(getExcludeList().includes("scripts")){return scripts}const isArray=Array.isArray(scripts);if(isHashProxy()){scripts=preNextScriptsByProxy(scripts,"Head");return scripts}scripts=deepMapScriptsToManifest(scripts,"Head");return isArray?scripts:React__default["default"].createElement(React.Fragment,{key:scripts.key},scripts)}getDynamicChunks(files){let scripts=super.getDynamicChunks(files);if(getExcludeList().includes("scripts")){return scripts}if(isHashProxy()){this.proxyfiedScripts.push(...deepMapExtractScripts(scripts));return[]}return ensureNextScriptsInManifest(scripts,this.context.canonicalBase,"Head")}getScripts(files){let scripts=super.getScripts(files);if(getExcludeList().includes("scripts")){return scripts}this.getPreloadDynamicChunks();this.getPreloadMainLinks(files);if(isHashProxy()){this.proxyfiedScripts.push(...deepMapExtractScripts(scripts));scripts=loadNextByProxy(this.proxyfiedScripts,"Head")}else{scripts=ensureNextScriptsInManifest(scripts,this.context.canonicalBase,"Head",true)}writeManifestToFileWithLock(pullManifest());return scripts}render(){if(!getExcludeList().includes("scripts")){deepEnsureScriptElementsInManifest(this.props.children)}if(!getExcludeList().includes("styles")){collectStyleElem(...deepExtractStyleElemHashes(this.context.styles),...deepExtractStyleElemHashes(this.props.children))}return super.render()}constructor(...args){super(...args);this.proxyfiedScripts=[]}}class NextScript$1 extends Document.NextScript{getPolyfillScripts(){let scripts=super.getPolyfillScripts();if(getExcludeList().includes("scripts")){return scripts}if(isHashProxy()){const polyfillProxy=createFragmentPaddedProxy(scripts);return polyfillProxy}return ensureNextScriptsInManifest(scripts,this.context.canonicalBase)}getPreNextScripts(){let scripts=super.getPreNextScripts();if(getExcludeList().includes("scripts")){return scripts}if(isHashProxy()){scripts=preNextScriptsByProxy(scripts);return scripts}const isArray=Array.isArray(scripts);scripts=deepMapScriptsToManifest(scripts);return isArray?scripts:React__default["default"].createElement(React.Fragment,{key:scripts.key},scripts)}getDynamicChunks(files){let scripts=super.getDynamicChunks(files);if(getExcludeList().includes("scripts")){return scripts}if(isHashProxy()){this.proxyfiedScripts.push(...deepMapExtractScripts(scripts));return[]}return ensureNextScriptsInManifest(scripts,this.context.canonicalBase)}getScripts(files){let scripts=super.getScripts(files);if(getExcludeList().includes("scripts")){return scripts}if(isHashProxy()){this.proxyfiedScripts.push(...scripts);scripts=loadNextByProxy(this.proxyfiedScripts)}else{scripts=ensureNextScriptsInManifest(scripts,this.context.canonicalBase,undefined,true)}return scripts}constructor(...args){super(...args);this.proxyfiedScripts=[]}}const deepEnsureNonceInChildren=(nonce3,children1,exclude=[])=>{if(!nonce3){return}const recurse=children=>{if((isScriptElement(children)||isScriptPreloadLink(children))&&!exclude.includes("scripts")||(isStyleElement(children)||isStyleSheetElement(children))&&!exclude.includes("styles")){try{children.props={...withStringChildrenAsInlineCode(children).props,nonce:nonce3,integrity:null}}catch{}}else if(isElementWithChildren(children)){recurse(children.props.children)}else if(Array.isArray(children)){children.forEach(recurse)}};recurse(children1)};const deepMapWithNonce=(nonce4,children2,exclude=[])=>{if(!nonce4){return children2}const recurse=children=>{if((isScriptElement(children)||isScriptPreloadLink(children))&&!exclude.includes("scripts")||(isStyleElement(children)||isStyleSheetElement(children))&&!exclude.includes("styles")){return[React__default["default"].cloneElement(children,{nonce:nonce4,integrity:null})]}else if(isElementWithChildren(children)){return recurse(children.props.children)}else if(Array.isArray(children)){return children.map(recurse)}return[]};return flatten$1(recurse(children2))};class Head extends Document.Head{getPreNextScripts(){let scripts=super.getPreNextScripts();const isArray=Array.isArray(scripts);scripts=deepMapWithNonce(this.props.nonce,scripts,getExcludeList());return isArray?scripts:React__default["default"].createElement(React.Fragment,{key:scripts.key},scripts)}render(){const nonce5=this.props.nonce;deepEnsureNonceInChildren(nonce5,this.context.styles,getExcludeList());deepEnsureNonceInChildren(nonce5,this.props.children,getExcludeList());return super.render()}}class NextScript extends Document.NextScript{getPreNextScripts(){let scripts=super.getPreNextScripts();const isArray=Array.isArray(scripts);scripts=deepMapWithNonce(this.props.nonce,scripts,getExcludeList());return isArray?scripts:React__default["default"].createElement(React.Fragment,{key:scripts.key},scripts)}}const provideComponents=props=>{const isProd=process.env.NODE_ENV==="production";const anyProps=props;const isDynamic=props.__NEXT_DATA__.gssp||props.__NEXT_DATA__.gip||props.__NEXT_DATA__.appGip;const isStatic=!isDynamic;const nonce6=anyProps.nonce;if(isProd&&isDynamic&&nonce6){return{Head:({children})=>React__default["default"].createElement(Head,{nonce:nonce6},children),NextScript:()=>React__default["default"].createElement(NextScript,{nonce:nonce6})}}if(isProd&&isStatic){return{Head:({children})=>React__default["default"].createElement(Head$1,null,children),NextScript:()=>React__default["default"].createElement(NextScript$1,null)}}return{Head:({children})=>React__default["default"].createElement(Document.Head,null,children),NextScript:()=>React__default["default"].createElement(Document.NextScript,null)}};const processStyles=($,nonce7,options)=>{if(options?.elements){const styleElements=$("style").get();if(nonce7){styleElements.forEach(el=>{$(el).attr("nonce",nonce7)})}else{const styleElemHashes=styleElements.map(el=>$.text(el.children)).filter(Boolean).map(hash);collectStyleElem(...styleElemHashes)}}if(options?.attributes){const styleAttrHashes=$("[style]").get().map(e=>hash(e.attribs["style"]));collectStyleAttr(...styleAttrHashes)}};const defaultOptions={styles:{attributes:true,elements:true}};const optionMerger=(k,l,r)=>typeof r==="boolean"?map$1(()=>r,l):r;const processHtml=(html,nonce8,options,exclude=[])=>{const mergedOptions=mergeDeepWithKey$1(optionMerger,defaultOptions,options??{});const $=cheerio__default["default"].load(html,{},false);if(!exclude.includes("styles")){processStyles($,nonce8,mergedOptions.styles)}return $.html()};const collectCustomRawCss=(initialProps,hashRawCss,exclude=[])=>{if(!exclude.includes("styles")&&initialProps&&hashRawCss){const customElemHashes=hashRawCss.flatMap(el=>{if(typeof el==="string"){return[hash(el)]}const styleOrStyles=el(initialProps);return typeof styleOrStyles==="string"?[hash(styleOrStyles)]:styleOrStyles.map(hash)});collectStyleElem(...customElemHashes)}};const trustifyInitialPropsSafeParts=(initialProps,nonce9,hashRawCss,exclude=[])=>{collectCustomRawCss(initialProps,hashRawCss,exclude);if(nonce9){deepEnsureNonceInChildren(nonce9,initialProps.head,exclude);deepEnsureNonceInChildren(nonce9,initialProps.styles,exclude)}else{if(!exclude.includes("scripts")){deepEnsureScriptElementsInManifest(initialProps.head)}if(!exclude.includes("styles")){collectStyleElem(...deepExtractStyleElemHashes(initialProps.head,exclude));collectStyleElem(...deepExtractStyleElemHashes(initialProps.styles,exclude));collectStyleElem(hash(""));collectStyleAttr(hash("display:block;width:0;height:0;border:0;visibility:hidden"))}}};const getCspInitialProps=async({ctx,passInitialProps,trustifyScripts=true,trustifyStyles=false,hashRawCss=[],processHtmlOptions,hashBasedByProxy=true})=>{const initialProps=passInitialProps||await Document__default["default"].getInitialProps(ctx);if(process.env.NODE_ENV!=="production"){return{...initialProps,nonce:undefined}}const excludeList1=[...!trustifyScripts?["scripts"]:[],...!trustifyStyles?["styles"]:[],];setExcludeList(excludeList1);setIsHashProxy(hashBasedByProxy);const nonce10=getCtxNonce(ctx);trustifyInitialPropsSafeParts(initialProps,nonce10,hashRawCss,excludeList1);initialProps.html=processHtml(initialProps.html,nonce10,processHtmlOptions,excludeList1);if(!nonce10){return{...initialProps,nonce:undefined}}const builder2=getCtxCsp(ctx);if(!builder2.isEmpty()){if(!excludeList1.includes("styles")){builder2.withStyleHashes(pullStyleElem(),pullStyleAttr(),false);builder2.withStyleNonceApplied(nonce10)}builder2.withScriptNonceApplied(nonce10);setCtxCsp(ctx,builder2)}return{...initialProps,nonce:nonce10}};exports.HashHead=Head$1;exports.HashNextScript=NextScript$1;exports.NonceHead=Head;exports.NonceNextScript=NextScript;exports.collectIterableScript=collectIterableScript;exports.collectScriptElement=collectScriptElement;exports.collectStyleAttr=collectStyleAttr;exports.collectStyleElem=collectStyleElem;exports.deepEnsureNonceInChildren=deepEnsureNonceInChildren;exports.deepEnsureScriptElementsInManifest=deepEnsureScriptElementsInManifest;exports.deepExtractStyleElemHashes=deepExtractStyleElemHashes;exports.deepMapExtractScripts=deepMapExtractScripts;exports.deepMapStripIntegrity=deepMapStripIntegrity;exports.deepMapWithNonce=deepMapWithNonce;exports.generateNonce=generateNonce;exports.getCreateCtxNonceIdempotent=getCreateCtxNonceIdempotent;exports.getCspInitialProps=getCspInitialProps;exports.getCtxCsp=getCtxCsp;exports.getCtxNonce=getCtxNonce;exports.gipWithNonce=gipWithNonce;exports.gipWithNonceAppliedToCsp=gipWithNonceAppliedToCsp;exports.gsspWithNonce=gsspWithNonce;exports.gsspWithNonceAppliedToCsp=gsspWithNonceAppliedToCsp;exports.hash=hash;exports.iterableScripts=iterableScripts;exports.logCtxHeaders=logCtxHeaders;exports.provideComponents=provideComponents;exports.pullManifest=pullManifest;exports.pullManifestScripts=pullManifestScripts;exports.pullStyleAttr=pullStyleAttr;exports.pullStyleElem=pullStyleElem;exports.sameLengthPaddedFlatZip=sameLengthPaddedFlatZip;exports.setCtxCsp=setCtxCsp;exports.setHashAlgorithm=setHashAlgorithm;exports.setNonceBits=setNonceBits
